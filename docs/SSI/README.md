# SSI in EDC


## IDS

At the time of writing IDS dows not support Self-Sovereign Identities (SSI) components, like Verifiable Credentials or Decentalized Identities.

The communication between two Eclipse Dataspace Connectors (EDC) happens solely over the IDS protocol. So for the EDC to be able to support IDS, it is necessary to extend the protocol.

This document suggest to introduce the following two components into IDS
1. Instead of the IDS DynamicAttributeToken IDS messages may also contain a VerifiablePresentationToken.
2. Additionally to the already existing RequestMessages IDS should support a VerifiableCredentialRequestMessage, too.


### Security Token

Each IDS message **must** contain a `securityToken`. When this token is generated by the DAPS it is called `DynamicAttributeToken`.

Example for the IDS DAPS Security Token (as it is now)
```json
{
  "@context" : "https://w3id.org/idsa/contexts/context.jsonld",
  "@type" : "ids:DescriptionRequestMessage",
  "modelVersion" : "4.1.0",
  "issued" : {
      "@value" : "2019-12-21T13:32:33.073+02:00",
      "@type" : "http://www.w3.org/2001/XMLSchema#dateTimeStamp"
    },
  "issuerConnector" : {"@id" : "http://example.org#connector" },
  "securityToken" : {
      "@type" : "ids:DysnamicAttributeToken",
      "tokenValue" : "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImRlZmF1bHQifQ.eyJ...",
      "tokenFormat" : { "@id": "https://w3id.org/idsa/code/tokenformat/JWT" }
    },
    "requestedElement" : { "@id": "http://example.org/some-URI" },
  "@id" : "https://w3id.org/idsa/autogen/selfDescriptionRequest/b0731661-7df1-43e5-bb75-50f0709f31c9"
}
```

Example of the new SSI Security Token for Catena-X
```json
"securityToken" : {
      "@type" : "cx:VerifiablePresentationToken",
      "value" : "<see-value-below>"
  }
```

Example of the new SSI Security Token Value for Catena-X
```json
{
  "@context": [
    "https://www.w3.org/2018/credentials/v1"
  ],
  "type": "VerifiablePresentation",
  "verifiableCredential": [
        {
            "@context": [
                "https://www.w3.org/2018/credentials/v1",
                "https://raw.githubusercontent.com/catenax-ng/product-core-schemas/main/businessPartnerData"
            ],
            "id": "http://catena-x.net/credentials/524621c6-9391-4093-9034-10961cdb4f2a",
            "issuer": "did:sov:indy:<authority-company/catena-x>",
            "issuanceDate": "2021-06-16T18:56:59Z",
            "holderIdentifier": "BPN00001111",
            "type": [
                "MembershipCredential",
                "VerifiableCredential"
            ],
            "credentialSubject": {
                "id": "did:sov:indy:<company-a>",
                "type": "MembershipCredential",
                "memberOf": "Catena-X",
                "status": "Active",
                "startTime": "2021-06-16T18:56:59Z"
            },
            "proof": {
                "type": "RsaSignature2018",
                "created": "2017-06-18T21:19:10Z",
                "proofPurpose": "assertionMethod",
                "verificationMethod": "https://example.edu/issuers/565049#key-1",
                "jws": "eyJhbGciOiJSUzI1NiIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..TCYt5X
                    sITJX1CxPCT8yAV-TVkIEq_PbChOMqsLfRoPsnsgw5WEuts01mq-pQy7UJiN5mgRxD-WUc
                    X16dUEMGlv50aqzpqh4Qktb3rk-BuQy72IFLOqV0G_zS245-kronKb78cPN25DGlcTwLtj
                    PAYuNzVBAh4vGHSrQyHUdBBPM"
            }
        },
        {
            "@context": [
                "https://www.w3.org/2018/credentials/v1",
                "https://raw.githubusercontent.com/catenax-ng/product-core-schemas/main/businessPartnerData"
            ],
            "id": "http://catena-x.net/credentials/c9e5f4a4-bbed-4101-aa09-cc689f35e882",
            "issuer": "did:sov:indy:<company-a>",
            "issuanceDate": "2021-06-16T18:56:59Z",
            "type": [
                "AudienceCredential",
                "VerifiableCredential"
            ],
            "credentialSubject": {
                "type": "AudienceCredential",
                "audience": "did:sov:indy:<company-b>",
                "status": "Active",
                "startTime": "2021-06-16T18:56:59Z"
            },
            "proof": {
                "type": "RsaSignature2018",
                "created": "2017-06-18T21:19:10Z",
                "proofPurpose": "assertionMethod",
                "verificationMethod": "https://example.edu/issuers/565049#key-1",
                "jws": "eyJhbGciOiJSUzI1NiIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..TCYt5X
                    sITJX1CxPCT8yAV-TVkIEq_PbChOMqsLfRoPsnsgw5WEuts01mq-pQy7UJiN5mgRxD-WUc
                    X16dUEMGlv50aqzpqh4Qktb3rk-BuQy72IFLOqV0G_zS245-kronKb78cPN25DGlcTwLtj
                    PAYuNzVBAh4vGHSrQyHUdBBPM"
            }
        }
  ],
  "proof": {
    "type": "RsaSignature2018",
    "created": "2018-09-14T21:19:10Z",
    "proofPurpose": "authentication",
    "verificationMethod": "did:example:ebfeb1f712ebc6f1c276e12ec21#keys-1",
    "challenge": "1f44d55f-f161-4938-a659-f8026467f126",
    "domain": "4jt78h47fh47",
    "jws": "eyJhbGciOiJSUzI1NiIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..kTCYt5
      XsITJX1CxPCT8yAV-TVIw5WEuts01mq-pQy7UJiN5mgREEMGlv50aqzpqh4Qq_PbChOMqs
      LfRoPsnsgxD-WUcX16dUOqV0G_zS245-kronKb78cPktb3rk-BuQy72IFLN25DYuNzVBAh
      4vGHSrQyHUGlcTwLtjPAnKb78"
  }
}
```





## EDC

### Policy

Example Policy for BPN enforcement using verifiable credentials

see [credentials_policy](examples/credentials_policy.json)